<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.61">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-148411216-7"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-148411216-7",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="PayID Developer Documentation and Reference Guides" href="/payid-documentation/review-apps/landing-page/f13343/opensearch.xml"><title data-react-helmet="true">Metrics | PayID Developer Documentation and Reference Guides</title><meta data-react-helmet="true" property="og:image" content="http://localhost:3000/payid-documentation/review-apps/landing-page/f13343/img/payid.png"><meta data-react-helmet="true" property="twitter:image" content="http://localhost:3000/payid-documentation/review-apps/landing-page/f13343/img/payid.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for PayID Developer Documentation and Reference Guides"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Metrics | PayID Developer Documentation and Reference Guides"><meta data-react-helmet="true" name="description" content="The reference implementation of PayID server automatically collects metrics using Prometheus. By default, metrics are pushed to the RippleX Prometheus pushgateway. This document describes how you can explicitly configure the PayID server to push to RippleX, or how to collect and analyze these metrics using your own metrics server."><meta data-react-helmet="true" property="og:description" content="The reference implementation of PayID server automatically collects metrics using Prometheus. By default, metrics are pushed to the RippleX Prometheus pushgateway. This document describes how you can explicitly configure the PayID server to push to RippleX, or how to collect and analyze these metrics using your own metrics server."><meta data-react-helmet="true" property="og:url" content="http://localhost:3000/payid-documentation/review-apps/landing-page/f13343/metrics"><link data-react-helmet="true" rel="shortcut icon" href="/payid-documentation/review-apps/landing-page/f13343/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="http://localhost:3000/payid-documentation/review-apps/landing-page/f13343/metrics"><link rel="stylesheet" href="/payid-documentation/review-apps/landing-page/f13343/styles.cad687cb.css">
<link rel="preload" href="/payid-documentation/review-apps/landing-page/f13343/styles.eb15ac61.js" as="script">
<link rel="preload" href="/payid-documentation/review-apps/landing-page/f13343/runtime~main.4fe4e95d.js" as="script">
<link rel="preload" href="/payid-documentation/review-apps/landing-page/f13343/main.fbf4fb32.js" as="script">
<link rel="preload" href="/payid-documentation/review-apps/landing-page/f13343/1.5ba717da.js" as="script">
<link rel="preload" href="/payid-documentation/review-apps/landing-page/f13343/2.70959adc.js" as="script">
<link rel="preload" href="/payid-documentation/review-apps/landing-page/f13343/36.36ef37a4.js" as="script">
<link rel="preload" href="/payid-documentation/review-apps/landing-page/f13343/39.52e456a0.js" as="script">
<link rel="preload" href="/payid-documentation/review-apps/landing-page/f13343/0c8543ee.3f140cc6.js" as="script">
<link rel="preload" href="/payid-documentation/review-apps/landing-page/f13343/17896441.500df69e.js" as="script">
<link rel="preload" href="/payid-documentation/review-apps/landing-page/f13343/1dba1ecf.5072d371.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top navbarHideable_3046"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a href="http://localhost:8000" target="_self" rel="noopener noreferrer" class="navbar__brand"><img class="navbar__logo" src="/payid-documentation/review-apps/landing-page/f13343/img/icon.svg" alt="PayID: Unifying payments through a universal payment identifier to simplify sending and receiving payments"><strong class="navbar__title"></strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/payid-documentation/review-apps/landing-page/f13343/">Documentation</a><a href="https://api.payid.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Reference</a><a href="http://localhost:8000/contact" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Contact Us</a><a href="https://github.com/payid-org/payid" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link github-button header-github-link" aria-label="GitHub repository">GitHub repository</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="http://localhost:8000" target="_self" rel="noopener noreferrer" class="navbar__brand"><img class="navbar__logo" src="/payid-documentation/review-apps/landing-page/f13343/img/icon.svg" alt="PayID: Unifying payments through a universal payment identifier to simplify sending and receiving payments"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/payid-documentation/review-apps/landing-page/f13343/">Documentation</a></li><li class="menu__list-item"><a href="https://api.payid.org" target="_blank" rel="noopener noreferrer" class="menu__link">API Reference</a></li><li class="menu__list-item"><a href="http://localhost:8000/contact" target="_blank" rel="noopener noreferrer" class="menu__link">Contact Us</a></li><li class="menu__list-item"><a href="https://github.com/payid-org/payid" target="_blank" rel="noopener noreferrer" class="menu__link github-button header-github-link" aria-label="GitHub repository">GitHub repository</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC sidebarWithHideableNavbar_2IoJ"><a href="http://localhost:8000" target="_self" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_Snse"><img src="/payid-documentation/review-apps/landing-page/f13343/img/icon.svg" alt="PayID: Unifying payments through a universal payment identifier to simplify sending and receiving payments"><strong></strong></a><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/payid-documentation/review-apps/landing-page/f13343/">Home</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Get Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/verifiable-payid-tutorial">Get Started with Verifiable PayID</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/ripplex-dev-kit-payid-get-started">Get Started with RippleX Dev Kit and PayID</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/metrics-tutorial">Metrics Tutorial</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Reference Implementation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/payid-documentation/review-apps/landing-page/f13343/payid-reference-overview">Reference Implementation Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/payid-documentation/review-apps/landing-page/f13343/payid-cli">PayID CLI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/payid-documentation/review-apps/landing-page/f13343/verifiable-payid">Enhance Security With Verifiable PayID</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/payid-documentation/review-apps/landing-page/f13343/payid-discovery">Discover a PayID</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/payid-documentation/review-apps/landing-page/f13343/payid-best-practices">Security Best Practices</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/payid-documentation/review-apps/landing-page/f13343/integrate-payid-users">Integrate Existing User Databases</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/payid-documentation/review-apps/landing-page/f13343/metrics">Metrics</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment Options</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/intro-deploy">Deployment Options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/payid-server-requirements">Server Requirements</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/local-deployment">Deploy Locally Without Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/deploy-with-docker">Deploy a PayID Server with Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/aws-lambda-deploy">Deploy on AWS Lambda</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/remote-deployment">Deploy on AWS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/nginx-ssl-deploy">Set Up NGINX Reverse Proxy and SSL</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">PayID References</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/api-reference">API Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/payid-cli-reference">PayID CLI Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/payid-headers">Headers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/payid-interfaces">Interfaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/payid-documentation/review-apps/landing-page/f13343/payid-schemas">Schemas</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/payid-documentation/review-apps/landing-page/f13343/ripplex-dev-kit-payid">RippleX Dev Kit Integration</a></li><li class="menu__list-item"><a class="menu__link" href="/payid-documentation/review-apps/landing-page/f13343/community-resources">Community Resources</a></li><li class="menu__list-item"><a class="menu__link" href="/payid-documentation/review-apps/landing-page/f13343/release-notes">Release Notes</a></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Metrics</h1></header><div class="markdown"><p>The reference implementation of PayID server automatically collects metrics using Prometheus. By default, metrics are pushed to the RippleX Prometheus pushgateway. This document describes how you can explicitly configure the PayID server to push to RippleX, or how to collect and analyze these metrics using your own metrics server.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="reporting-metrics-to-ripplex"></a>Reporting metrics to RippleX<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reporting-metrics-to-ripplex" title="Direct link to heading">#</a></h2><p>RippleX runs a metrics collection server for general use by anyone running a PayID server. Sharing your metrics with RippleX allows the PayID community to aggregate and monitor PayID adoption and growth metrics in one place.</p><p>Metrics are reported to RippleX by default but you can push metrics to your own Prometheus pushgateway. Here&#x27;s how to configure your PayID server to do that:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># RippleX&#x27;s Prometheus pushgateway</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">PUSH_GATEWAY_URL=https://push00.mon.payid.tech</span></div></div></div></div></div><p>To opt out of pushing metrics entirely, set the following environment variable on your server:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">PUSH_PAYID_METRICS=false</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="available-metrics"></a>Available metrics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#available-metrics" title="Direct link to heading">#</a></h2><p>The PayID server captures the following metrics.</p><table><thead><tr><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td><code>payid_count</code></td><td>The number of PayID address mappings in the system. This is calculated periodically by querying the PayID database and published as metrics periodically (every 60 seconds by default). In Prometheus terms, this metric is a gauge.</td></tr><tr><td><code>payid_count.paymentNetwork</code></td><td>The payment network for the PayID address mapping. (XRPL, BTC, ETH, ACH, ...)</td></tr><tr><td><code>payid_count.environment</code></td><td>The payment networkâ€™s environment for the PayID address mapping (MAINNET, TESTNET, RINKEBY, ...)</td></tr><tr><td><code>payid_lookup_request</code></td><td>The number of PayID lookup requests. This metric is updated every time a PayID server is hit with a HTTP request to look up an address or addresses for a PayID.</td></tr><tr><td><code>payid_lookup_request.paymentNetwork</code></td><td>The payment network for the PayID address mapping. (XRPL, BTC, ETH, ACH, ...)</td></tr><tr><td><code>payid_lookup_request.environment</code></td><td>The payment networkâ€™s environment for the PayID address mapping (MAINNET, TESTNET, RINKEBY, ...)</td></tr><tr><td><code>payid_lookup_request.result</code></td><td>The result of the lookup. Possible values include: <ul><li><code>found</code> - An address was found for the PayID lookup.</li><li><code>not_found</code> - An address was not found for the PayID lookup (HTTP status code 404)</li><li><code>error</code> - There was an error in the PayID lookup request. For example, if the client provided an Accept request header that was invalid or missing.</li></ul></td></tr></tbody></table><p>You can use this data to generate real-time charts. For example, this chart shows how many PayID address mappings exist in the system over time:
<img src="/img/docs/payid_address_count.png" alt="PayID address mappings in system over time"></p><p>This chart shows the rate per minute of PayID lookup requests:
<img src="/img/docs/payid_lookups.png" alt="PayID lookups per minute"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="import-metrics-from-the-payid-server-to-prometheus"></a>Import metrics from the PayID server to Prometheus<a aria-hidden="true" tabindex="-1" class="hash-link" href="#import-metrics-from-the-payid-server-to-prometheus" title="Direct link to heading">#</a></h2><p>You can use a push or pull method to obtain metrics from Prometheus.</p><p><strong>Tip:</strong> Note that both push and pull methods can be used together simultaneously. For example, to pull metrics into an internal Prometheus server and push metrics to a third-party Prometheus server like RippleX.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="how-to-pull-metrics-to-prometheus"></a>How to pull metrics to Prometheus<a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-to-pull-metrics-to-prometheus" title="Direct link to heading">#</a></h3><p>Prometheus pulls metrics by scraping a known endpoint for metrics data. The PayID server exposes metrics in Prometheus format on the admin port (default <code>8081</code>). For simplicity, you can configure Prometheus to scrape metrics directly from the PayID server. Prometheus must be running inside the same network as PayID server because Prometheus needs access to the admin port. If multiple instances of the PayID server are being run behind a load balancer, then Prometheus must pull metrics directly from each instance, not through the load balancer. This direct method is recommended for collecting metrics using your own Prometheus server.</p><p>Here is a sample <code>prometheus.yml</code> configuration file set up to pull metrics from a PayID server running locally.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># my global config</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">scrape_interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 15s </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">evaluation_interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 15s </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Evaluate rules every 15 seconds. The default is every 1 minute.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># scrape_timeout is set to the global default (10s).</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># A scrape configuration containing exactly one endpoint to scrape:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Here it&#x27;s Prometheus itself.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">scrape_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">job_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;prometheus&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">honor_labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># metrics_path defaults to &#x27;/metrics&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># scheme defaults to &#x27;http&#x27;.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">static_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">targets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;localhost:8081&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="how-to-push-metrics-from-the-payid-server-to-prometheus"></a>How to push metrics from the PayID server to Prometheus<a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-to-push-metrics-from-the-payid-server-to-prometheus" title="Direct link to heading">#</a></h3><p>Alternatively, you can push metrics from the PayID server to Prometheus using a <a href="https://github.com/prometheus/pushgateway" target="_blank" rel="noopener noreferrer">pushgateway</a>. This setup requires running a pushgateway in addition to a Prometheus server, and configuring the PayID server to push metrics to the pushgateway. Prometheus then pulls metrics from the pushgateway. In this setup, Prometheus and pushgateway do not need to run inside the same network as the PayID server(s), but the PayID server must be able to reach the pushgateway over http. This is the recommended method for pushing metrics to a third party such as RippleX.</p><p>By default, the reference PayID server pushes metrics to the RippleX pushgateway. To push metrics to your own pushgateway, follow these steps:</p><ol><li>Set the environment variables <code>PUSH_GATEWAY_URL</code> with the url to your pushgateway.</li><li>Restart your PayID server.</li></ol><p>For example, if the fictitious company Vandelay Industries wants to push metrics to a pushgateway running at <code>https://some-pushgateway.com</code>, then set these environment variables: <code>PUSH_GATEWAY_URL= https://some-pushgateway.com</code>.</p><p>By default, a PayID server will push metrics every 15 seconds to the configured pushgateway. To change this frequency, set the <code>PUSH_METRICS_INTERVAL</code> value. For example, to push every 5 minutes (300 seconds), set <code>PUSH_METRICS_INTERVAL=300</code>. This value must be a positive number.</p><p>As mentioned above, you can also explicitly set <code>PUSH_GATEWAY_URL=https://push00.mon.payid.tech</code> to push the metrics from your PayID server to RippleX.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="visualize-metrics-with-prometheus-and-grafana"></a>Visualize metrics with Prometheus and Grafana<a aria-hidden="true" tabindex="-1" class="hash-link" href="#visualize-metrics-with-prometheus-and-grafana" title="Direct link to heading">#</a></h2><p>Prometheus has an admin web console with limited visualization capabilities on port 9090 (default), as shown in this example.</p><p><img src="/img/docs/prometheus-metrics.png" alt="PayID metrics on Prometheus"></p><p>To build dashboards with multiple charts, you can <a href="https://prometheus.io/docs/visualization/grafana/" target="_blank" rel="noopener noreferrer">use Grafana and configure Prometheus as a datasource</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="deploy-a-payid-server-with-docker-and-pull-payid-metrics-into-prometheus"></a>Deploy a PayID server with Docker, and pull PayID metrics into Prometheus<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploy-a-payid-server-with-docker-and-pull-payid-metrics-into-prometheus" title="Direct link to heading">#</a></h2><p>In this tutorial, you will deploy a PayID server and run Prometheus locally using Docker, and you will create a configuration file for the PayID server so that PayID metrics are pulled into Prometheus.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="prerequisites"></a>Prerequisites<a aria-hidden="true" tabindex="-1" class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h3><p>Install the following software on your machine, if not already present.</p><ul><li><a href="https://www.npmjs.com/get-npm" target="_blank" rel="noopener noreferrer">npm</a></li><li><a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">docker</a></li><li><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" target="_blank" rel="noopener noreferrer">git</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="build-a-docker-container-for-setting-up-a-payid-server"></a>Build a Docker container for setting up a PayID server<a aria-hidden="true" tabindex="-1" class="hash-link" href="#build-a-docker-container-for-setting-up-a-payid-server" title="Direct link to heading">#</a></h3><p>Run these commands to build a Docker container for a PayID server.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://github.com/payid-org/payid.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> payid</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker build -t payid-server </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">.</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="create-docker-network-for-payid"></a>Create Docker network for PayID<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-docker-network-for-payid" title="Direct link to heading">#</a></h3><p>You will run several containers in Docker that must talk to each other. To set up these containers, create a docker network called <code>payid-network</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker network create payid-network</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="start-a-postgres-database"></a>Start a Postgres Database<a aria-hidden="true" tabindex="-1" class="hash-link" href="#start-a-postgres-database" title="Direct link to heading">#</a></h3><p>To have a PayID server, you require a Postgres database to store PayID accounts and address mappings. To do this, run the postgres database in docker with a default password of <code>password</code>, and tell the database to use the <code>payid-network</code> that you previously created. Name this docker container <code>payid-postgres</code>, so that you can reference the container by name when you connect your PayID server. Note that both the default database and the user are named <code>postgres</code>, as described at <a href="https://hub.docker.com/_/postgres" target="_blank" rel="noopener noreferrer">Postgres Docker Official Images</a>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -d --rm --name payid-postgres --network payid-network -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">POSTGRES_PASSWORD</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">password postgres</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="start-and-test-the-payid-server"></a>Start and test the PayID server<a aria-hidden="true" tabindex="-1" class="hash-link" href="#start-and-test-the-payid-server" title="Direct link to heading">#</a></h3><p>To start the PayID server, run the PayID server in docker using the image you created. You must also use the docker network <code>payid-network</code> so that it can connect to the <code>payid-postgres</code> container.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -it -p </span><span class="token number" style="color:rgb(247, 140, 108)">8080</span><span class="token plain">:8080 -p </span><span class="token number" style="color:rgb(247, 140, 108)">8081</span><span class="token plain">:8081 --name payid-server --network payid-network -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">DB_PASSWORD</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">password -e</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">DB_NAME</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">postgres -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">DB_HOSTNAME</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">payid-postgres payid-server</span></div></div></div></div></div><p>Test whether the PayID server is running by creating a PayID with this cURL command.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> --location --request POST </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;http://127.0.0.1:8081/users&#x27;</span><span class="token plain"> --header </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;PayID-API-Version: 2020-06-16&#x27;</span><span class="token plain"> --header </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Content-Type: application/json&#x27;</span><span class="token plain"> --data-raw </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">     &quot;payId&quot;: &quot;charlie</span><span class="token string variable" style="color:rgb(191, 199, 213)">$127</span><span class="token string" style="color:rgb(195, 232, 141)">.0.0.1&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">     &quot;addresses&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">         {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">             &quot;paymentNetwork&quot;: &quot;XRPL&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">             &quot;environment&quot;: &quot;TESTNET&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">             &quot;details&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">                 &quot;address&quot;: &quot;rDk7FQvkQxQQNGTtfM2Fr66s7Nm3k87vdS&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">             }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">         }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">     ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)"> }&#x27;</span></div></div></div></div></div><p>You should get a <code>Created</code> response.</p><p>Query the PayID server to make sure it resolves, using this cURL command.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> http://127.0.0.1:8080/charlie -H </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;PayID-Version: 1.0&quot;</span><span class="token plain"> -H </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Accept: application/xrpl-testnet+json&quot;</span><span class="token plain">`</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="start-prometheus"></a>Start Prometheus<a aria-hidden="true" tabindex="-1" class="hash-link" href="#start-prometheus" title="Direct link to heading">#</a></h3><p>In this step, you will run prometheus in docker and configure it to scrape the PayID serverâ€™s metrics. To do this, you need to create a <code>prometheus.yml</code> file on the host machine and mount it in the docker container.</p><p>Create a file named <code>prometheus.yml</code> with these contents.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">scrape_interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 15s </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">evaluation_interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 15s </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Evaluate rules every 15 seconds. The default is every 1 minute.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">scrape_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">job_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;payid-metric&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">honor_labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">static_configs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">targets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;payid-server:8081&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></div></div></div></div></div><p>Start the docker container:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -d --network payid-network -p </span><span class="token number" style="color:rgb(247, 140, 108)">9090</span><span class="token plain">:9090 -v </span><span class="token environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token plain">/prometheus.yml:/etc/prometheus/prometheus.yml prom/prometheus`</span></div></div></div></div></div><p>You can verify Prometheus is running by opening <code>http://localhost:9090/graph</code> in a browser.</p><p>You can verify metrics collection metrics are being collected by entering the following expression into the form:</p><p><code>sum(payid_count)</code></p><p>Click <code>Execute</code>. If successful, the results look like this:</p><p><img src="/img/docs/prometheus-sum.png" alt="PayID Metrics setup and configuration"></p><p>Click the <strong>Graph</strong> tab to display the results in graph format.</p><p>Here are some other example expressions:</p><ul><li><code>sum(payid_count) by (paymentNetwork)</code> - Sum of <code>payid</code> count by payment network, such as XRPL, BTC, and so forth.</li><li><code>sum(payid_lookup_request)</code> - Total number of <code>payid</code> lookup requests.</li><li><code>rate(payid_lookup_request[5m])</code> - Rate of <code>payid</code> lookup requests per second.</li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/payid-org/payid-documentation/tree/master/docs/metrics.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/payid-documentation/review-apps/landing-page/f13343/integrate-payid-users"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Integrate Existing User Databases</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/payid-documentation/review-apps/landing-page/f13343/intro-deploy"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deployment Options Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#reporting-metrics-to-ripplex" class="table-of-contents__link">Reporting metrics to RippleX</a></li><li><a href="#available-metrics" class="table-of-contents__link">Available metrics</a></li><li><a href="#import-metrics-from-the-payid-server-to-prometheus" class="table-of-contents__link">Import metrics from the PayID server to Prometheus</a><ul><li><a href="#how-to-pull-metrics-to-prometheus" class="table-of-contents__link">How to pull metrics to Prometheus</a></li><li><a href="#how-to-push-metrics-from-the-payid-server-to-prometheus" class="table-of-contents__link">How to push metrics from the PayID server to Prometheus</a></li></ul></li><li><a href="#visualize-metrics-with-prometheus-and-grafana" class="table-of-contents__link">Visualize metrics with Prometheus and Grafana</a></li><li><a href="#deploy-a-payid-server-with-docker-and-pull-payid-metrics-into-prometheus" class="table-of-contents__link">Deploy a PayID server with Docker, and pull PayID metrics into Prometheus</a><ul><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#build-a-docker-container-for-setting-up-a-payid-server" class="table-of-contents__link">Build a Docker container for setting up a PayID server</a></li><li><a href="#create-docker-network-for-payid" class="table-of-contents__link">Create Docker network for PayID</a></li><li><a href="#start-a-postgres-database" class="table-of-contents__link">Start a Postgres Database</a></li><li><a href="#start-and-test-the-payid-server" class="table-of-contents__link">Start and test the PayID server</a></li><li><a href="#start-prometheus" class="table-of-contents__link">Start Prometheus</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/payid-documentation/review-apps/landing-page/f13343/styles.eb15ac61.js"></script>
<script src="/payid-documentation/review-apps/landing-page/f13343/runtime~main.4fe4e95d.js"></script>
<script src="/payid-documentation/review-apps/landing-page/f13343/main.fbf4fb32.js"></script>
<script src="/payid-documentation/review-apps/landing-page/f13343/1.5ba717da.js"></script>
<script src="/payid-documentation/review-apps/landing-page/f13343/2.70959adc.js"></script>
<script src="/payid-documentation/review-apps/landing-page/f13343/36.36ef37a4.js"></script>
<script src="/payid-documentation/review-apps/landing-page/f13343/39.52e456a0.js"></script>
<script src="/payid-documentation/review-apps/landing-page/f13343/0c8543ee.3f140cc6.js"></script>
<script src="/payid-documentation/review-apps/landing-page/f13343/17896441.500df69e.js"></script>
<script src="/payid-documentation/review-apps/landing-page/f13343/1dba1ecf.5072d371.js"></script>
</body>
</html>